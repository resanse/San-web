# 2021Web后端期末测试

## 说明

- 测试时间： 14：00 - 18：00写到自己满意就可以离开
- 提交方式：现场提交
- 有问题问在场的学长
- 抄袭是坏文明
- 合理利用之前的作业、课件、搜索引擎，~~如有直接cv的代码请注明出处并加上自己详细的注释~~
- **请合理安排时间，不要死磕一道题**

## 1.并发相关

### (a)

```go
func main() {
	var mu sync.Mutex

	go func() {
		fmt.Println("有点强人锁男")
		mu.Lock()
	}()
	
	mu.Unlock()
}
```

这段代码在运行之后可能会报错，请解释原因



```
原因 :由于main函数执行的比 func执行的快 

因此 对一个 没有加锁的互斥锁进行加锁 导致 错误

简单暴力可以加  time.Sleep(time.Second)
```



### (b)

在``go``语言中使用`sync.Mutex`互斥锁同步是比较低级的做法，我们可以尝试使用管道``Channel``的堵塞来实现同步，

请对下面代码添加``Channel``，使之可以正常输出。

```go
func main() {
	//var mu sync.Mutex
	channel:=make(chan int)
	go func() {
		//mu.Lock()
		<-channel
		fmt.Println("有点强人锁男")
	}()
	//time.Sleep(time.Second)
	channek<-1
	close(channel)
	//mu.Unlock()

}
```

### (c)

**基于管道**，我们可以把打印的协程拓展为N个。

请在``main``函数中开启10个协程输出一段话，要求10行话全部输出完毕后再结束``main``函数。

```
func main() {
	//var wg sync.WaitGroup
	//wg.Add(10)
	channel:=make(chan int,10)
	for i:=0;i<10;i++{
		fmt.Println("重邮赢麻了")
		channel<-1
		//wg.Done()
	}
	//wg.Wait()
	for j:=0;j<10;j++ {
		<-channel
	}
	close(channel)
}

///没看题目 。。。。
```

### (d)

使用并发操作可以提高程序的运行速度，请实现高并发求一百万之内的所有素数

如果你参考了网络上的文章/程序，请附带上包含你个人理解的注释and被你参考文章/程序的链接

## 2.编码能力题

### 登dua廊

#### 题面

> 邓捷：对了，我叫阿捷，我也常来这里玩，他们都叫我捷哥，你们好，我一个人住，我的房子还蛮大的，欢迎你们来我家玩。玩累了就直接睡觉，没问题的。

> 嘉伟：那捷哥，我跟我朋友今天就去你家住啰～

~~于是在命运红线的牵引下，少年和少年相遇了~~

阿伟要前往捷哥的大house，但是首先需要登上高高的dua廊。

捷哥告诉阿伟：我的房子**共有``N+1``层**，我就住在顶层。**除了顶层外**，我的楼另有N层，每层M个房间，这M个房间**围成一圈**并**按逆时针方向**依次编号为``0…M-1``。其中一些房间有通往上一层的楼梯，另一些没有，每层楼的楼梯设计可能不同。

每个房间里有一个指示牌，指示牌上有一个数字``x``，**表示从这个房间开始按逆时针方向选择第``x``个有楼梯的房间**。假定该房间的编号为k，从该房间上楼，上楼后到达上一层的``k``号房间。比如当前房间的指示牌上写着2，则按逆时针方向开始尝试，找到第2个**有楼梯**的房间，从该房间上楼。如果当前房间本身就有楼梯通向上层，该房间作为第一个有楼梯的房间。

帮助找到每层上楼房间的指示牌上的数字（即每层第一个进入的房间内指示牌上的数字）总和为顶层捷哥屋子的密码。

请热心的你写一个程序，帮助阿伟算出密码。

你的程序需要满足所有符合要求的输入，都可以算出正确的密码。

#### 输入格式

第一行2个整数``N``和``M``，之间用一个空格隔开。

``N``表示除了顶层共``N``层楼，``M``表示除顶层外每层楼有``M``个房间。

接下来``N×M``行，每行两个整数，之间用一个空格隔开，每行描述一个房间内的情况，其中第``(i−1)×M+j``行表示第``i``层``j−1``号房间的情况``（i=1,2,…,N；j=1,2,…,M）``。

第一个整数表示该房间是否有楼梯通往上一层（``0``表示没有，``1``表示有），第二个整数表示指示牌上的数字。

注意，从``j``号房间的楼梯爬到上一层到达的房间一定也是``j``号房间。

最后一行，一个整数，表示阿伟从楼底层的几号房间进入开始登dua廊**（注：房间编号从0开始）**。

**你的程序需要对所有符合条件的输入，给出正确的输出**

#### 输出格式

一个整数，表示打开捷哥房间的密码。

#### 样例

样例输入1

```
2 3
1 2
0 3
1 4
0 1
1 5
1 2
1
```

样例输出1

```
5
```

样例说明1

```
第一层
0号房间，有楼梯通往上层，指示牌上的数字是2 
1号房间，无楼梯通往上层，指示牌上的数字是3 
2号房间，有楼梯通往上层，指示牌上的数字是4 
第二层
0号房间，无楼梯通往上层，指示牌上的数字是1 
1号房间，有楼梯通往上层，指示牌上的数字是5 
2号房间，有楼梯通往上层，指示牌上的数字是2

阿伟首先进入第一层“底层”的1号房间，记下指示牌上的数字为3，然后从这个房间开始，沿逆时针方向选择第3个有楼梯的房间2号房间进入，上楼后到达第二层的2号房间，记下指示牌上的数字为2，由于当前房间本身有楼梯通向上层，该房间作为第一个有楼梯的房间。因此，此时沿逆时针方向选择第2个有楼梯的房间即为1号房间，进入后上楼梯到达顶层。这时把上述记下的指示牌上的数字加起来，即3+2=5，所以密码就是5。
```

#### 补充说明

很多时候作为后端开发，我们需要处理一些非常复杂的逻辑，所以对编码能力会有较高的要求。

这题只是题面又长又绕，但是当你get到题意之后，会发现其实并不难，

如果代码实在实现不了，叙述一下你的思路也可以。

```
	type Door struct {
		Isexit int
		Munber int
	}
	var code[100][1000] Door
	使用结构体二维数组 储存每一层 每一个房间的信息
	然后 加入计数变量 
	从刚进来的第一个房间按照 是否能上上一层进行循环查找 进行多轮循环 直到找到数值
	进入下一层进行同样的操作
	最后 阿伟就可以开门了
```

## 3. 业务题

### 3G含金量

在2077年，cqupt发行了“3G币”以取代陈旧的重邮一卡通系统

请实现以下功能：

- 登陆，注册
- 给自己充值
- 用户之间转账（考虑dao层error,确保不会出现A余额增加B余额不变的情况，且不应出现负数）
- 给自己的交易记录增加备注
- 根据备注能够模糊查询交易记录
- 部署到自己的服务器上，并提供一个help接口，返回自己实现了哪些接口
- 可以添加一份README.md文件，加上你的项目说明

**附加题：**

- 一份经过测试的接口文档
- 设置定时扣费
- 生存转账链接，点击链接后视为向对方转账
- 提供一个接口，返回上述链接的二维码
- 实现一切你可以想到的新功能，并提供在help接口
- 使用一切你会的新技术